# 分布式事务

## CAP 原则

AP原则又叫CAP定理, 同时又被称作布鲁尔定理(Brewer’s theorem), 指的是在一个分布式系统中, 不可能同时满足以下三点

**注: 这指的是系统**

1. 一致性(Consistency): 指强一致性, 在写操作完成后开始的任何读操作都必须返回该值, 或者后续写操作的结果.
2. 可用性(Availability): 指高可用, 每次向未崩溃的节点发送请求, 总能保证收到响应数据(允许不是最新数据)
3. 分区容忍性(Partition tolerance): 分布式系统在遇到任何网络分区故障的时候, 仍然能够对外提供满足一致性和可用性的服务.

## 一致性的分类

1. 强一致性: 系统中的某个数据被成功更新后, 后续任何对该数据的读取操作都将得到更新后的值, 即: 原子一致性
2. 弱一致性: 系统中的某个数据被更新后, 后续对该数据的读取操作可能得到更新后的值, 也可能是更改前的值, 但即使过了不一致时间窗口这段时间后,
   后续对该数据的读取也不一定是最新值
3. 最终一致性: 是弱一致性的特殊形式, 存储系统保证在没有新的更新的条件下, 最终所有的访问都是最后更新的值,
   不保证在任意时刻任意节点上的同一份数据都是相同的, 但是随着时间的迁移, 不同节点上的同一份数据总是在向趋同的方向变化.
   简单说, 就是在一段时间后, 节点间的数据会最终达到一致状态.

## BASE 理论

BASE 理论是对 CAP 中的一致性和可用性进行一个权衡的结果.

理论的核心思想是: 我们无法做到强一致, 但每个应用都可以根据自身的业务特点, 采用适当的方式来使系统达到最终一致性.

1. BA(Basic Available)基本可用: 整个系统在某些不可抗力的情况下, 仍然能够保证"可用性", 即一定时间内仍然能够返回一个明确的结果
2. S(Soft State)柔性状态: 指允许系统中的数据存在中间状态, 并认为该中间状态的存在不会影响系统的整体可用性,
   即允许系统不同节点的数据副本之间进行数据同步的过程存在延时
3. E(Eventual Consisstency)最终一致性: 同一数据的不同副本的状态, 可以不需要实时一致, 但一定要保证经过一定时间后仍然是一致的.

## 分布式事务的解决方案

### 2 阶段提交(2PC)

是常用的分布式事务解决方案, 即将事务的提交过程分为两个阶段来进行处理.

两个阶段分别为

1. 准备阶段
2. 提交阶段
